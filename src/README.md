# Chatme-AI
#### Video Demo:  <https://youtu.be/cagbn7caxYM?si=CgAige8e8rIhDAmh>
#### Description:


### Configuration before start using the app!
First create a data base with the name of your preference, a table that must have the name "user" and 4 columns as follows:
1. the first one must be called "id" and must be of type smallint(4)
2. the second one must be called "username" and must be of type varchar(20)
3. the third one must be called "password" and must be of type char(200)
4. the last one must be called "fullname" and must be of type varchar(50)

> [!IMPORTANT]
> Important: If you're going to add a new user to the data base when you add the password must be hashed, to do this you can go to the config file and uncomment the print at the end, there you write your password, run the config file by executing `python .\src\test_project` and you should see in the terminal a lot of letters similar to this: `scrypt:32768:8:1$sR0hfAONwoKPFYii$89e4a4001c999f4870d789fcd4acfc7dfc1fed101cdb631d14a7b1b4c8d220b4ab8e6f943947979e17610938ad320375ded96190d70e5dfced396dcaf114a479` that must be the value for the column password.

### Configure the database
Go to the config file and replace the values of the following attributes in the DevelopmentConfig class:
1. MYSQL_HOST = 'localhost' 
2. MYSQL_USER = 'root' here goes the name of the user to acces to the data base
3. MYSQL_PASSWORD = '' The password should go here in case it is necessary, otherwise it can remain empty
4. MYSQL_DB = 'chat-users' Hero goes the name of the data base

Create a virtual environment by executing `virtualenv env` in the terminal. In case you don't have "virtualenv" installed, you can install it by executing `pip install virtualenv`.

Activate the virtual environment by executing `.\env\Scripts\activate`.

To finish the configuration, install all the libraries by executing `pip install -r requirements.txt` in the terminal.

### Now the app is ready to run!
Just execute `python .\src\project.py` and in the browser search 127.0.0.1, you should be able to see the login page.

### To test the app just run the test file by executing `pytest .\src\test_project.py`



## Files description


#### project.py file

Is the main file of the project, it is responsible for managing the different routes of the website, it also processes the information received from the user such as the login data or the questions that the user asks the AI ​​and connects with various files to be able to return responses as if the login is valid or the response generated by the AI.

The file imports some libraries like flask, flask mysqldb, etc. which are used for the rendering of the web page through python, the management of the database, csrf_tokens for greater security of the web, among others. Some project files such as config, openai handler, ModelUser, etc. are also imported, they're used to connect with the open AI API, load configuration data for the database and obtain data from the latter.

**app.route(route)**

1. route = /
   - This is the default route, with the function "index" the user is automatically redirected to the /login path

2. route = /login
   - This route accepts two methods, GET and POST, the login function validates if a POST type request was made, if not, it returns the rendering of the web page. If the condition is met, the information provided by the user is used to check if the user is in the database and if the password is correct, if the data is correct the user is redirected to the web page to chat with the AI, but if they are not correct the login page is reloaded along with an error message.

3. route = /chat_page
   - This route, like the login route, accepts the GET and POST methods, however, in order to access this page the user must be logged in, otherwise they will be redirected to the login page. If the user is logged in, the home function will evaluate what type of request is made, just as in the previous login function. If the request is POST, the information from the json file is saved to be able to send the text that the user wrote to the AI and after obtaining a response from it, return this information to the website.

4. route = /logout
   - This route changes the user's status to not logged in, and redirects the user to the login page.

**functions to handle errors**

1. status_401: This function handles the 401 error that occurs when a user tries to access a protected route without logging in, the function automatically redirects the user to the login page.

2. status_404: This function handles the 404 error that occuers when a user tries to access a non-existent route, the function displays a text that says the following "The page you search does not exist".


#### config.py file

- load_AI_configuration function: Load environment variables and set up API key for OpenAI.

- config class: Sets a secret key that will be used by the DevelopmentConfig class.

- DevelopmentConfig class: Contains the data necessary to connect to the database.

- config dictionary: It stores the database configuration for the development of the app, it could also store other configurations such as for testing.

- TestConfig class: This class is used to disable CSRF tokens if necessary, such as for testing.

- commented print: prints to the terminal the hashed password that the user entered in "generate_password_hash".


#### test_project.py file

Contains 5 different functions to ensure that all routes have a correct status code

1. test_index: This test tries to access the default route to confirm that it is redirected to the /login route, the status code must be 302 because this is the status code that is obtained when doing a redirect

2. test_login: This test tries to access the login route and confirms that the status code is 200, which indicates that everything has gone as expected and the page has loaded.

3. test_logout: This test tries to access the logout route to confirm that it is redirected to the /login route, the status code must be 302 because this is the status code that is obtained when doing a redirect

4. test_home: This test tries to access the chat_page route, since no user is logged in it should give us the 401 error

5. test_status_404: This test tries to access a route that does not exist so it should get a 404 status code.


#### AI folder > openai_handler.py file

Here we first configure the openai key, then the generate_chatbot_response function is responsible for assigning a role to the AI, then it sends the user's message to the AI and finally returns the response it obtained.


#### models folder > ModelUser.py file
